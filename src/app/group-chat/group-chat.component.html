<div class="chat-box">
  <!-- Group Header -->
  <div class="group-header">
    <button class="back-btn" (click)="groupChatBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <div class="group-info-section" (click)="openGroupInfo()">
      <div class="group-avatar" *ngIf="!groupImage">
        {{ getInitial(groupName) }}
      </div>
      <div class="group-avatar group-img-avatar" *ngIf="groupImage">
        <img [src]="groupImage" [alt]="groupName" />
      </div>
      <div class="group-details">
        <div class="group-details-left">
          <div class="group-name">{{ groupName }}</div>
          <div *ngIf="typingUsers.length > 0" class="typing-indicator">
            {{ displayTypingText }}
          </div>
        </div>
        <div class="group-details-right"></div>
          <div class="group-members">{{ memberCount }} members</div>
      </div>
    </div>

    <button class="info-btn" (click)="openGroupInfo()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
    </button>
  </div>

  <div class="messages" id="group-chat-scroll">
    <div *ngFor="let msg of messages; let i = index">
      <div class="main-separator" *ngIf="isNewDate(i)">
        <div class="date-separator">
          {{ getDateLabel(msg.created) }}
        </div>
      </div>
    
      <div
        [ngClass]="{
          'my-message': msg.fromUser === fromUser,
          'other-message': msg.fromUser !== fromUser
        }"
      >
        <div class="msg-info">
          <div class="msg-text" [id]="'msg-'+msg.id" (contextmenu)="onMsgRightClick($event, msg)">
            <b *ngIf="msg.fromUser !== fromUser" class="sender-name">{{ msg.fromUser }}</b>

            <div *ngIf="msg.replyTo" class="reply-preview" (click)="goToMessage(msg.replyTo.id)">
              <div class="reply-user">{{ msg.replyTo.fromUser }}</div>
              <div class="reply-text">
                <span>{{ msg.replyTo.message }}</span>
              </div>
            </div>

            <p class="message-content">{{ msg.message }}</p>
            <span class="msg-time">{{ msg.created | date: 'shortTime' }}</span>

            <div *ngIf="showMsgContextMenu && selectedMsgId == msg.id" class="msg-context-menu">
              <ul>
                <li (click)="replyToMessage(msg)">Reply</li>
                <li *ngIf="msg.message != ''" (click)="copyMessage(msg.message)">Copy message</li>
                <li *ngIf="msg.fromUser == fromUser" (click)="deleteMsg(selectedMsgId!)">Delete</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="isLoader" class="loader-container">
      <div class="loader"></div>
      <p>Loading messages...</p>
    </div>
  </div>

  <button 
    *ngIf="showScrollButton" 
    class="scroll-to-bottom-btn"
    (click)="scrollToBottom(true)"
    title="Scroll to bottom"
  >
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M12 5v14M19 12l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="message-input-container">
    <div *ngIf="replyingToMessage" class="input-Reply-preview">
      <div class="reply-info">
        <span class="replying-text">Replying to {{ replyingToMessage.fromUser }}:</span>
        <div class="reply-message">
          <p>{{ replyingToMessage.message }}</p>
        </div>
      </div>
      <button (click)="cancelReply()" class="cancel-reply-btn">âœ–</button>
    </div>
    <div class="input-area">
      <div class="input-wrapper">
        <input
          #messageInput
          [(ngModel)]="message"
          (keyup.enter)="send()"
          (input)="onTyping()"
          placeholder="Type a message..."
          class="message-input"
        />

        <button (click)="send()" class="send-btn" [disabled]="!message.trim()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  
</div>