<div class="profile-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loader">
      <div class="loader-circle"></div>
      <div class="loader-circle"></div>
      <div class="loader-circle"></div>
    </div>
    <p class="loading-text">Loading profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="error-state">
    <div class="error-card">
      <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h3>Oops! Something went wrong</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-button" (click)="loadUserInfo()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
        </svg>
        Try Again
      </button>
    </div>
  </div>

  <!-- Profile Content -->
  <div *ngIf="userInfo && !isLoading" class="profile-content">
    
    <div class="profile-hero">
      <div class="cover-image">
        <!-- Edit Button - Only for Current User -->
        <button *ngIf="isCurrentUser && !isEditing" class="edit-profile-btn" (click)="toggleEditMode()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Edit Profile
        </button>
      </div>
      
      <div class="profile-avatar-section">
        <div class="avatar-wrapper" *ngIf="userInfo.profileImage != ''">
          <img 
            [src]="previewImage || userInfo.profileImage" 
            [alt]="userInfo.fullName"
            class="avatar-image"
          />
          
          <!-- Online/Offline Badge -->
          <div class="avatar-badge online" *ngIf="isUserOnline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                viewBox="0 0 24 24" fill="none" stroke="green" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="9" />
              <path d="M9 12l2 2 4-4" />
            </svg>
          </div>

          <div class="avatar-badge offline" *ngIf="!isUserOnline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="9" />
              <line x1="15" y1="9" x2="9" y2="15" />
              <line x1="9" y1="9" x2="15" y2="15" />
            </svg> 
          </div>

          <!-- Edit Image Button - Only in Edit Mode -->
          <button *ngIf="isCurrentUser && isEditing" class="edit-image-btn" (click)="triggerFileInput()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
          </button>
          
          <!-- Hidden File Input -->
          <input 
            type="file" 
            accept="image/*" 
            (change)="onProfileImageChange($event)" 
            style="display: none;"
          />
        </div>
        
        <div class="profile-header-info">
          <h1 class="profile-fullname">{{ userInfo.fullName }}</h1>
          <p class="profile-handle">&#64;{{ userInfo.userName }}</p>
          <div class="profile-status online" *ngIf="isUserOnline">
            <span class="status-dot online"></span>
            <span class="status-text">Online</span>
          </div>
          <div class="profile-status offline" *ngIf="!isUserOnline">
            <span class="status-dot offline"></span>
            <span class="status-text">Offline</span>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-grid">
      <div class="left-column">
        <div class="contact-card card">
          <div class="card-header">
            <h2 class="card-title">Contact Information</h2>
          </div>
          <div class="card-content">
            
            <div class="contact-item">
              <div class="contact-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect width="20" height="16" x="2" y="4" rx="2"/>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Email Address</span>
                <!-- <input 
                  *ngIf="isEditing" 
                  type="email" 
                  [(ngModel)]="editModel.email" 
                  class="edit-input"
                  placeholder="Enter email"
                /> -->
                <a  
                  [href]="'mailto:' + userInfo.email" 
                  class="contact-value"
                >
                  {{ userInfo.email }}
                </a>
              </div>
            </div>

            <div class="contact-item">
              <div class="contact-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Username</span>
                <!-- <input 
                  *ngIf="isEditing" 
                  type="text" 
                  [(ngModel)]="editModel.userName" 
                  class="edit-input"
                  placeholder="Enter username"
                /> -->
                <span class="contact-value">
                  &#64;{{ userInfo.userName }}
                </span>
              </div>
            </div>

            <div class="contact-item">
              <div class="contact-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Phone Number</span>
                <input 
                  *ngIf="isEditing" 
                  type="tel" 
                  [(ngModel)]="editModel.phoneNumber" 
                  class="edit-input"
                  placeholder="Enter phone number"
                />
                <a 
                  *ngIf="!isEditing" 
                  [href]="'tel:' + userInfo.phoneNumber" 
                  class="contact-value"
                >
                  {{ formatPhoneNumber(userInfo.phoneNumber) }}
                </a>
              </div>
            </div>

            <div class="contact-item">
              <div class="contact-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
              </div>
              <div class="contact-details">
                <span class="contact-label">Full Name</span>
                <input 
                  *ngIf="isEditing" 
                  type="text" 
                  [(ngModel)]="editModel.fullName" 
                  class="edit-input"
                  placeholder="Enter full name"
                />
                <span *ngIf="!isEditing" class="contact-value">
                  {{ userInfo.fullName }}
                </span>
              </div>
            </div>

            <!-- Save/Cancel Buttons -->
            <div *ngIf="isEditing" class="edit-actions">
              <button class="save-btn" (click)="saveProfileChanges()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                  <polyline points="17 21 17 13 7 13 7 21"/>
                  <polyline points="7 3 7 8 15 8"/>
                </svg>
                Save Changes
              </button>
              <button class="cancel-btn" (click)="cancelEdit()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>